(function(){var n;n=angular.module("ngQuickDate",[]);n.provider("ngQuickDateDefaults",function(){return{options:{dateFormat:"dd.MM.yyyy",timeFormat:"h:mm a",labelFormat:null,placeholder:"Установить дату",hoverText:null,buttonIconHtml:null,closeButtonHtml:"&times;",nextLinkHtml:"&rarr;",prevLinkHtml:"&larr;",disableTimepicker:!1,disableClearButton:!1,defaultTime:null,dayAbbreviations:["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],dateFilter:null,parseDateFunction:function(n){var t;return t=Date.parse(n),isNaN(t)?null:new Date(t)}},$get:function(){return this.options},set:function(n,t){var i,u,r;if(typeof n=="object"){r=[];for(i in n)u=n[i],r.push(this.options[i]=u);return r}return this.options[n]=t}}});n.directive("datepicker",["ngQuickDateDefaults","$filter","$sce",function(n,t,i){return{restrict:"E",require:"ngModel",scope:{dateFilter:"=?",ngModel:"=",onChange:"&"},replace:!0,link:function(r,u,f){var k,o,h,c,y,p,w,e,l,a,b,v,s;return y=f.debug&&f.debug.length,w=function(){return r.toggleCalendar(!1),r.weeks=[],r.inputDate=null,typeof r.ngModel=="string"&&(r.ngModel=e(r.ngModel)),typeof f.initValue=="string"&&(r.ngModel=e(f.initValue)),b(),v(),l()},b=function(){var t,u;for(t in n)u=n[t],t.match(/[Hh]tml/)?r[t]=i.trustAsHtml(n[t]||""):!r[t]&&f[t]?r[t]=f[t]:r[t]||(r[t]=n[t]);return r.labelFormat||(r.labelFormat=r.dateFormat,r.disableTimepicker||(r.labelFormat+=" "+r.timeFormat)),f.iconClass&&f.iconClass.length?r.buttonIconHtml=i.trustAsHtml("<i ng-show='iconClass' class='"+f.iconClass+"'><\/i>"):void 0},o=!1,window.document.addEventListener("click",function(){return o||(r.toggleCalendar(!1),r.$apply()),o=!1}),angular.element(u[0])[0].addEventListener("click",function(){return o=!0}),v=function(){return r.ngModel?(r.inputDate=t("date")(r.ngModel,n.dateFormat),r.inputTime=t("date")(r.ngModel,n.timeFormat)):(r.inputDate=null,r.inputTime=null)},l=function(){var n;return n=r.ngModel?new Date(r.ngModel):new Date,n.toString()==="Invalid Date"&&(n=new Date),n.setDate(1),r.calendarDate=new Date(n)},a=function(){var t,n,l,a,v,o,s,y,f,w,e,i,c,u;for(o=r.calendarDate.getDay(),a=p(r.calendarDate.getFullYear(),r.calendarDate.getMonth()),v=Math.ceil((o+a)/7),e=[],t=new Date(r.calendarDate),t.setDate(t.getDate()+o*-1+1),s=i=0,u=v-1;0<=u?i<=u:i>=u;s=0<=u?++i:--i)for(e.push([]),l=c=0;c<=6;l=++c)n=new Date(t),r.defaultTime&&(f=r.defaultTime.split(":"),n.setHours(f[0]||0),n.setMinutes(f[1]||0),n.setSeconds(f[2]||0)),y=r.ngModel&&n&&h(n,r.ngModel),w=h(n,new Date),e[s].push({date:n,selected:y,disabled:typeof r.dateFilter=="function"?!r.dateFilter(n):!1,other:n.getMonth()!==r.calendarDate.getMonth(),today:w}),t.setDate(t.getDate()+1);return r.weeks=e},k=function(n,i){return t("date")(n,i)},s=function(n){return typeof n=="string"?e(n):n},e=n.parseDateFunction,h=function(n,t,i){return i==null&&(i=!1),i?n-t==0:(n=s(n),t=s(t),n&&t&&n.getYear()===t.getYear()&&n.getMonth()===t.getMonth()&&n.getDate()===t.getDate())},c=function(n,t){return(n&&t)?parseInt(n.getTime()/6e4)===parseInt(t.getTime()/6e4):!1},p=function(n,t){return[31,n%4==0&&n%100!=0||n%400==0?29:28,31,30,31,30,31,31,30,31,30,31][t]},r.$watch("ngModel",function(n,t){if(n!==t&&(v(),l(),r.onChange&&!c(n,t)))return r.onChange()}),r.$watch("calendarDate",function(n,t){if(n!==t)return a()}),r.$watch("calendarShown",function(){var n;return n=angular.element(u[0].querySelector(".quickdate-date-input"))[0],n.select()}),r.mainButtonStr=function(){return r.ngModel?t("date")(r.ngModel,r.labelFormat):r.placeholder},r.toggleCalendar=function(n){return r.calendarShown=isFinite(n)?n:!r.calendarShown},r.setDate=function(n,t){var i;return(t==null&&(t=!0),i=!r.ngModel&&n||r.ngModel&&!n||n.getTime()!==s(r.ngModel).getTime(),typeof r.dateFilter=="function"&&!r.dateFilter(n))?!1:(r.ngModel=n,t&&r.toggleCalendar(!1),!0)},r.setDateFromInput=function(n){var t,i,u;n==null&&(n=!1);try{if(t=e(r.inputDate),!t)throw"Invalid Date";if(!r.disableTimepicker&&r.inputTime&&r.inputTime.length&&t){if(u=r.disableTimepicker?"00:00:00":r.inputTime,i=e(""+r.inputDate+" "+u),!i)throw"Invalid Time";t=i}if(!c(r.ngModel,t)&&!r.setDate(t,!1))throw"Invalid Date";return n&&r.toggleCalendar(!1),r.inputDateErr=!1,r.inputTimeErr=!1}catch(f){if(f==="Invalid Date")return r.inputDateErr=!0;if(f==="Invalid Time")return r.inputTimeErr=!0}},r.onDateInputTab=function(){return r.disableTimepicker&&r.toggleCalendar(!1),!0},r.onTimeInputTab=function(){return r.toggleCalendar(!1),!0},r.nextMonth=function(){return r.calendarDate=new Date(new Date(r.calendarDate).setMonth(r.calendarDate.getMonth()+1))},r.prevMonth=function(){return r.calendarDate=new Date(new Date(r.calendarDate).setMonth(r.calendarDate.getMonth()-1))},r.clear=function(){return r.setDate(null,!0)},w(),a(),y?console.log("quick date scope:",r):void 0},template:"<div class='quickdate'>\n  <a href='' ng-focus='toggleCalendar()' ng-click='toggleCalendar()' class='quickdate-button' title='{{hoverText}}'><div ng-hide='iconClass' ng-bind-html='buttonIconHtml'><\/div>{{mainButtonStr()}}<\/a>\n  <div class='quickdate-popup' ng-class='{open: calendarShown}'>\n    <a href='' tabindex='-1' class='quickdate-close' ng-click='toggleCalendar()'><div ng-bind-html='closeButtonHtml'><\/div><\/a>\n    <div class='quickdate-text-inputs'>\n      <div class='quickdate-input-wrapper'>\n        <label>Дата<\/label>\n        <input class='quickdate-date-input' name='inputDate' type='text' ng-model='inputDate' placeholder='1/1/2013' ng-blur=\"setDateFromInput()\" ng-enter=\"setDateFromInput(true)\" ng-class=\"{'quickdate-error': inputDateErr}\" ng-tab='onDateInputTab()' />\n      <\/div>\n      <div class='quickdate-input-wrapper' ng-hide='disableTimepicker'>\n        <label>Время<\/label>\n        <input class='quickdate-time-input' name='inputTime' type='text' ng-model='inputTime' placeholder='12:00 PM' ng-blur=\"setDateFromInput(false)\" ng-enter=\"setDateFromInput(true)\" ng-class=\"{'quickdate-error': inputTimeErr}\" ng-tab='onTimeInputTab()'>\n      <\/div>\n    <\/div>\n    <div class='quickdate-calendar-header'>\n      <a href='' class='quickdate-prev-month quickdate-action-link' tabindex='-1' ng-click='prevMonth()'><div ng-bind-html='prevLinkHtml'><\/div><\/a>\n      <span class='quickdate-month'>{{calendarDate | date:'MMMM yyyy'}}<\/span>\n      <a href='' class='quickdate-next-month quickdate-action-link' ng-click='nextMonth()' tabindex='-1' ><div ng-bind-html='nextLinkHtml'><\/div><\/a>\n    <\/div>\n    <table class='quickdate-calendar'>\n      <thead>\n        <tr>\n          <th ng-repeat='day in dayAbbreviations'>{{day}}<\/th>\n        <\/tr>\n      <\/thead>\n      <tbody>\n        <tr ng-repeat='week in weeks'>\n          <td ng-mousedown='setDate(day.date)' ng-class='{\"other-month\": day.other, \"disabled-date\": day.disabled, \"selected\": day.selected, \"is-today\": day.today}' ng-repeat='day in week'>{{day.date | date:'d'}}<\/td>\n        <\/tr>\n      <\/tbody>\n    <\/table>\n    <div class='quickdate-popup-footer'>\n      <a href='' class='quickdate-clear' tabindex='-1' ng-hide='disableClearButton' ng-click='clear()'>Clear<\/a>\n    <\/div>\n  <\/div>\n<\/div>"}}]);n.directive("ngEnter",function(){return function(n,t,i){return t.bind("keydown keypress",function(t){if(t.which===13)return n.$apply(i.ngEnter),t.preventDefault()})}});n.directive("ngTab",function(){return function(n,t,i){return t.bind("keydown keypress",function(t){if(t.which===9)return console.log("regular tab!"),n.$apply(i.ngTab)})}})}).call(this)